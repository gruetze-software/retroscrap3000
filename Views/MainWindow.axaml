<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:RetroScrap3000.ViewModels"
        x:Class="RetroScrap3000.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/icon.ico"
        Title="{Binding AppTitle}"
        Background="{DynamicResource ThemeBackgroundBrush}"
        Width="1000" Height="700" WindowStartupLocation="CenterScreen">

    <Grid RowDefinitions="Auto, *">
        
        <Border Grid.Row="0" 
                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" 
                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" 
                BorderThickness="0,0,0,1" 
                Padding="10">
            <Grid ColumnDefinitions="*, Auto, Auto, Auto">
                <TextBox Grid.Column="0" 
                         Text="{Binding RomPath}" 
                         Watermark="Pfad zu den ROMs wählen..." 
                         VerticalContentAlignment="Center"
                         Margin="0,0,0,0"> <TextBox.InnerRightContent>
                        <Button Command="{Binding SelectFolderCommand}" Content="..." Padding="10,0" Background="Transparent" BorderThickness="0"/>
                    </TextBox.InnerRightContent>
                </TextBox>

                <Button Grid.Column="1" Command="{Binding ScanCommand}" Content="Scan ROMs" 
                        Background="{DynamicResource SystemAccentColor}" Foreground="White"
                        FontWeight="Bold" Padding="15,5" Margin="10,0,5,0"/>

                <Button Grid.Column="2" Click="OpenOptions_Click" Content="⚙" Padding="10,5"/>
                
                <Border Grid.Column="3" IsVisible="{Binding IsUpdateAvailable}" Background="Orange" 
                        CornerRadius="15" Padding="10,2" Margin="10,0,0,0" VerticalAlignment="Center">
                    <TextBlock Text="Update!" FontSize="10" FontWeight="Bold" Foreground="Black"/>
                </Border>
            </Grid>
        </Border>

        <Grid Grid.Row="1" ColumnDefinitions="350, 5, *">
            
            <Grid Grid.Column="0" RowDefinitions="*, 5, 2*">
                <Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundListLowBrush}" 
                        BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,0,1,1">
                    <DockPanel Margin="10">
                        <TextBlock DockPanel.Dock="Top" Text="SYSTEME" FontSize="12" FontWeight="Bold" Foreground="{DynamicResource SystemAccentColor}" Margin="0,0,0,10"/>
                       <ListBox ItemsSource="{Binding Systems}" SelectedItem="{Binding SelectedSystem}" Background="Transparent">
                        <ListBox.ItemTemplate>
                            <DataTemplate x:DataType="vm:SystemViewModel">
                                <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,2">
                                    <Image Source="{Binding SystemIcon}" 
                                        Width="20" 
                                        Height="20" 
                                        Stretch="Uniform"
                                        VerticalAlignment="Center"/>
                                    
                                    <TextBlock Text="{Binding SystemName}" 
                                            VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    </DockPanel>
                </Border>

                <GridSplitter Grid.Row="1" 
                    Height="5"
                    HorizontalAlignment="Stretch" 
                    Background="Transparent"
                    ResizeDirection="Rows">
                    <GridSplitter.Styles>
                        <Style Selector="GridSplitter:pointerover">
                            <Setter Property="Background" Value="{DynamicResource SystemAccentColor}"/>
                        </Style>
                    </GridSplitter.Styles>
                </GridSplitter>

                <Border Grid.Row="2" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,0,1,0">
                    <DockPanel Margin="10">
                        <TextBlock DockPanel.Dock="Top" Text="{Binding SelectedSystem.SystemName, FallbackValue='GAMES', StringFormat='GAMES: {0}'}" 
                                FontSize="12" FontWeight="Bold" Foreground="{DynamicResource SystemAccentColor}" Margin="0,0,0,10"/>
                        <ListBox ItemsSource="{Binding SelectedSystem.Roms}" SelectedItem="{Binding SelectedGame}" Background="Transparent">
                            <ListBox.ItemTemplate>
                                <DataTemplate x:DataType="vm:GameViewModel">
                                    <TextBlock Text="{Binding Name}" />
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </DockPanel>
                </Border>
            </Grid>

            <GridSplitter Grid.Column="1" 
                Width="5" 
                HorizontalAlignment="Stretch" 
                Background="Transparent">
                <GridSplitter.Styles>
                    <Style Selector="GridSplitter:pointerover">
                        <Setter Property="Background" Value="{DynamicResource SystemAccentColor}"/>
                    </Style>
                </GridSplitter.Styles>
            </GridSplitter>

            <Border Grid.Column="2" Background="{DynamicResource ThemeBackgroundBrush}" Padding="30">
                <Grid RowDefinitions="Auto, *">
                    
                    <Image Grid.Row="0" 
                        Source="{Binding SelectedSystem.SystemBanner}" 
                        Height="60" 
                        HorizontalAlignment="Right" 
                        VerticalAlignment="Top" 
                        Stretch="Uniform"
                        Margin="0,0,0,20"/>

                    <ContentControl Grid.Row="1" Content="{Binding SelectedGame}">
                        <ContentControl.ContentTemplate>
                            <DataTemplate DataType="vm:GameViewModel">
                                <StackPanel Spacing="15">
                                    <TextBlock Text="{Binding Name}" FontSize="28" FontWeight="ExtraBold"/>
                                    <Separator Background="{DynamicResource SystemControlForegroundBaseLowBrush}"/>
                                    
                                    <TextBlock Text="{Binding Description}" TextWrapping="Wrap" Opacity="0.7"/>
                                </StackPanel>
                            </DataTemplate>
                        </ContentControl.ContentTemplate>
                        
                        <ContentControl.Content>
                            <TextBlock Text="Wähle ein Spiel aus, um Details anzuzeigen." 
                                    HorizontalAlignment="Center" 
                                    VerticalAlignment="Center" 
                                    Opacity="0.5" 
                                    FontStyle="Italic"/>
                        </ContentControl.Content>
                    </ContentControl>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>